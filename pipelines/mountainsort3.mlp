{"processing_server":"typhoon","pipelines":[{"spec":{"name":"main","description":"","inputs":[],"outputs":[],"parameters":[]},"steps":[{"step_type":"pipeline","pipeline_name":"synthesize","inputs":{},"outputs":{"raw":"raw","geom":"geom","waveforms_true":"waveforms_true","firings_true":"firings_true"},"parameters":{"duration":"600","samplerate":"30000"}},{"step_type":"pipeline","pipeline_name":"sort","inputs":{"raw":"raw","geom":"geom"},"outputs":{"firings_out":"firings","filt_out":"filt","pre_out":"pre"},"parameters":{"samplerate":"30000","detect_sign":""}},{"step_type":"pipeline","pipeline_name":"curate","inputs":{"pre":"pre","firings":"firings"},"outputs":{"curated_firings":"curated_firings"},"parameters":{"samplerate":"30000"}}],"input_files":[],"output_files":[]},{"spec":{"name":"synthesize","description":"","inputs":[],"outputs":[{"name":"raw"},{"name":"geom"},{"name":"waveforms_true"},{"name":"firings_true"}],"parameters":[{"name":"duration","description":"Durations of simulated dataset in seconds"},{"name":"samplerate"}]},"steps":[{"step_type":"processor","processor_name":"pyms.synthesize_random_waveforms","inputs":{},"outputs":{"waveforms_out":"waveforms_true","geometry_out":"geom"},"parameters":{"upsamplefac":"13"}},{"step_type":"processor","processor_name":"pyms.synthesize_random_firings","inputs":{},"outputs":{"firings_out":"firings_true"},"parameters":{"samplerate":"${samplerate}","duration":"${duration}"}},{"step_type":"processor","processor_name":"pyms.synthesize_timeseries","inputs":{"firings":"firings_true","waveforms":"waveforms_true"},"outputs":{"timeseries_out":"raw"},"parameters":{"duration":"${duration}","waveform_upsamplefac":"13"}},{"step_type":"processor","processor_name":"pyms.synthesize_random_firings","inputs":{},"outputs":{"firings_out":"test_firings","console_out":"test_cons"},"parameters":{"duration":"310"}}],"input_files":[],"output_files":[]},{"name":"sort","script":"/* Define the spec */\ninputs_opt('raw','filt','pre','geom');\noutputs('firings_out');\noutputs_opt('filt_out','pre_out');\nparam('samplerate',30000);\nparam('freq_min',300);\nparam('freq_max',6000);\nparam('freq_wid',1000);\nparam('whiten','true');\nparam('detect_threshold',3);\nparam('detect_sign',0);\nparam('adjacency_radius',0);\n      \n\n_Pipeline.run=function(X) {\n  var pp=X.parameters;\n  \n  var pre='pre';\n  if (!X.hasInput('pre')) {\n    \n    var filt='filt';\n    if (!X.hasInput('filt')) {\n      if (!X.hasInput('raw')) {\n        console.error('Missing input: raw, filt or pre');\n        return -1;\n      }\n      X.runProcess('ms3.bandpass_filter',\n                   {timeseries:'raw'},\n                   {timeseries_out:'filt_out'},\n                   {samplerate:pp.samplerate,freq_min:pp.freq_min,freq_max:pp.freq_max,freq_wid:pp.freq_wid}\n                  );\n      filt='filt_out';\n    }\n  \n  \n    if (pp.whiten=='true') {\n      X.runProcess('ms3.whiten',\n                   {timeseries:filt},\n                   {timeseries_out:'pre_out'},\n                   {}\n                  );\n    }\n    else {\n      X.runProcess('pyms.normalize_channels',\n                   {timeseries:'filt'},\n                   {timeseries_out:'pre_out'},\n                   {}\n                  );\n    }\n    pre='pre_out';\n  }\n  \n  var p={\n    detect_threshold:pp.detect_threshold,\n    detect_sign:pp.detect_sign,\n    adjacency_radius:pp.adjacency_radius\n  };\n  var geom='';\n  if (X.hasInput('geom')) {\n    geom='geom';\n    p.adjacency_radius=pp.adjacency_radius;\n  }\n  X.runProcess('mountainsortalg.ms3',\n               {timeseries:pre},\n               {firings_out:'firings_out'},\n               p);\n               \n};\n\n/////////////////////////////////////////////////////////////////////\n\n\nfunction param(str,val) {\n      if (val===undefined) {\n        _Pipeline.spec.parameters.push({name:str});\n      }\n      else {\n        _Pipeline.spec.parameters.push({name:str,optional:true,default_value:val});\n      }\n}\n                \nfunction inputs(str1,str2,str3,str4) {\n  if (str1) _Pipeline.spec.inputs.push({name:str1});\n  if (str2) _Pipeline.spec.inputs.push({name:str2});\n  if (str3) _Pipeline.spec.inputs.push({name:str3});\n  if (str4) _Pipeline.spec.inputs.push({name:str4});\n}\n\nfunction inputs_opt(str1,str2,str3,str4) {\n  if (str1) _Pipeline.spec.inputs.push({name:str1,optional:true});\n  if (str2) _Pipeline.spec.inputs.push({name:str2,optional:true});\n  if (str3) _Pipeline.spec.inputs.push({name:str3,optional:true});\n  if (str4) _Pipeline.spec.inputs.push({name:str4,optional:true});\n}\n\nfunction outputs(str1,str2,str3,str4) {\n  if (str1) _Pipeline.spec.outputs.push({name:str1});\n  if (str2) _Pipeline.spec.outputs.push({name:str2});\n  if (str3) _Pipeline.spec.outputs.push({name:str3});\n  if (str4) _Pipeline.spec.outputs.push({name:str4});\n}\n\nfunction outputs_opt(str1,str2,str3,str4) {\n  if (str1) _Pipeline.spec.outputs.push({name:str1,optional:true});\n  if (str2) _Pipeline.spec.outputs.push({name:str2,optional:true});\n  if (str3) _Pipeline.spec.outputs.push({name:str3,optional:true});\n  if (str4) _Pipeline.spec.outputs.push({name:str4,optional:true});\n}","steps":[],"spec":{"name":"","description":"","inputs":[],"outputs":[],"parameters":[]}},{"spec":{"name":"curate","description":"","inputs":[{"name":"pre"},{"name":"firings"}],"outputs":[{"name":"curated_firings"}],"parameters":[{"name":"samplerate"}]},"steps":[{"step_type":"processor","processor_name":"ms3.cluster_metrics","inputs":{"timeseries":"pre","firings":"firings"},"outputs":{"cluster_metrics_out":"metrics1"},"parameters":{"samplerate":"${samplerate}"}},{"step_type":"processor","processor_name":"ms3.isolation_metrics","inputs":{"timeseries":"pre","firings":"firings"},"outputs":{"metrics_out":"metrics2"},"parameters":{"compute_bursting_parents":"true"}},{"step_type":"processor","processor_name":"ms3.combine_cluster_metrics","inputs":{"metrics_list":["metrics1","metrics2"]},"outputs":{"metrics_out":"metrics"},"parameters":{}},{"step_type":"processor","processor_name":"pyms.create_label_map","inputs":{"metrics":"metrics"},"outputs":{"label_map_out":"label_map"},"parameters":{}},{"step_type":"processor","processor_name":"pyms.apply_label_map","inputs":{"firings":"firings","label_map":"label_map"},"outputs":{"firings_out":"curated_firings"},"parameters":{}}],"input_files":[],"output_files":[]}],"input_files":[],"output_files":[{"prv":{"original_checksum":"4802c5bd1d4f325500d9a704a78dd95ee35f1fd0","original_fcs":"head1000-b19bfa0e6ab0eee6b5c48ea632c591dc4491cb59","original_path":"/typhoon/jason/prvbucket/_mountainprocess/output_firings_out_1dbef61491","original_size":478556,"prv_version":"0.11"},"name":"curated_firings","on_server":true},{"prv":{"original_checksum":"e1d80e3b637796e7775103754e5b95cdfa0dacf3","original_fcs":"head1000-5c955c1e9bf41c5733454b692346c07930b55542","original_path":"/typhoon/jason/prvbucket/_mountainprocess/output_timeseries_out_50027d1609","original_size":360000020,"prv_version":"0.11"},"name":"filt","on_server":true},{"prv":{"original_checksum":"945d592720f0fce3c6154b865cb72f8060ef5916","original_fcs":"head1000-6bc350ed079926dd38b1cb315ee5f7df16f847e7","original_path":"/typhoon/jason/prvbucket/_mountainprocess/output_firings_out_0bc58ac97c","original_size":1112948,"prv_version":"0.11"},"name":"firings","on_server":true},{"prv":{"original_checksum":"83035a7ea7fe8dcb45ae3b919bf82082f1070957","original_fcs":"head1000-abe4ecf8f440e6197eeb4b199e71888aeb8a96d9","original_path":"/typhoon/jason/prvbucket/_mountainprocess/output_firings_out_e857934248","original_size":661292,"prv_version":"0.11"},"name":"firings_true","on_server":true},{"prv":{"original_checksum":"baa4efd40e96d2f1df2e38bc9caaef4db947fae5","original_fcs":"head1000-baa4efd40e96d2f1df2e38bc9caaef4db947fae5","original_path":"/typhoon/jason/prvbucket/_mountainprocess/output_geometry_out_635f2903f9","original_size":20,"prv_version":"0.11"},"name":"geom","on_server":true},{"prv":{"original_checksum":"f45c752c69c5075f54ab3666fe7074f2ff6e3b11","original_fcs":"head1000-45ab45da501eceb336323fc929ec1ea200b0ede8","original_path":"/typhoon/jason/prvbucket/_mountainprocess/output_timeseries_out_5bf26dde59","original_size":360000020,"prv_version":"0.11"},"name":"pre","on_server":true},{"prv":{"original_checksum":"b7c5d169d94b0e17fced02c6893d82a768cf66b2","original_fcs":"head1000-b46220b63fa5f5ecd16c4b86b2e912bc10273215","original_path":"/typhoon/jason/prvbucket/_mountainprocess/output_timeseries_out_bfcb937a69","original_size":360000020,"prv_version":"0.11"},"name":"raw","on_server":true},{"prv":{"original_checksum":"83da71cb0874fc48d9536f32808b17c6acfd54aa","original_fcs":"head1000-7d11910508d5e1045015a326b3d2170d1f24e9d9","original_path":"/typhoon/jason/prvbucket/_mountainprocess/output_waveforms_out_635f2903f9","original_size":2600024,"prv_version":"0.11"},"name":"waveforms_true","on_server":true}],"jobs":[{"job_type":"pipeline","input_file_names":{},"output_file_names":{"raw":"raw","geom":"geom","waveforms_true":"waveforms_true","firings_true":"firings_true"},"unresolved_parameters":{"duration":"600","samplerate":"30000"},"input_files":{},"output_files":{"raw":{"prv":{"original_checksum":"b7c5d169d94b0e17fced02c6893d82a768cf66b2","original_fcs":"head1000-b46220b63fa5f5ecd16c4b86b2e912bc10273215","original_path":"/typhoon/jason/prvbucket/_mountainprocess/output_timeseries_out_bfcb937a69","original_size":360000020,"prv_version":"0.11"}},"geom":{"prv":{"original_checksum":"baa4efd40e96d2f1df2e38bc9caaef4db947fae5","original_fcs":"head1000-baa4efd40e96d2f1df2e38bc9caaef4db947fae5","original_path":"/typhoon/jason/prvbucket/_mountainprocess/output_geometry_out_635f2903f9","original_size":20,"prv_version":"0.11"}},"waveforms_true":{"prv":{"original_checksum":"83da71cb0874fc48d9536f32808b17c6acfd54aa","original_fcs":"head1000-7d11910508d5e1045015a326b3d2170d1f24e9d9","original_path":"/typhoon/jason/prvbucket/_mountainprocess/output_waveforms_out_635f2903f9","original_size":2600024,"prv_version":"0.11"}},"firings_true":{"prv":{"original_checksum":"83035a7ea7fe8dcb45ae3b919bf82082f1070957","original_fcs":"head1000-abe4ecf8f440e6197eeb4b199e71888aeb8a96d9","original_path":"/typhoon/jason/prvbucket/_mountainprocess/output_firings_out_e857934248","original_size":661292,"prv_version":"0.11"}}},"parameters":{"duration":"600","samplerate":"30000"},"status":"finished","error":"","process_id":"","pipeline_name":"synthesize"},{"job_type":"pipeline","input_file_names":{"raw":"raw","geom":"geom"},"output_file_names":{"firings_out":"firings","filt_out":"filt","pre_out":"pre"},"unresolved_parameters":{"samplerate":"30000","detect_sign":""},"input_files":{"raw":{"prv":{"original_checksum":"b7c5d169d94b0e17fced02c6893d82a768cf66b2","original_fcs":"head1000-b46220b63fa5f5ecd16c4b86b2e912bc10273215","original_path":"/typhoon/jason/prvbucket/_mountainprocess/output_timeseries_out_bfcb937a69","original_size":360000020,"prv_version":"0.11"}},"geom":{"prv":{"original_checksum":"baa4efd40e96d2f1df2e38bc9caaef4db947fae5","original_fcs":"head1000-baa4efd40e96d2f1df2e38bc9caaef4db947fae5","original_path":"/typhoon/jason/prvbucket/_mountainprocess/output_geometry_out_635f2903f9","original_size":20,"prv_version":"0.11"}}},"output_files":{"firings_out":{"prv":{"original_checksum":"945d592720f0fce3c6154b865cb72f8060ef5916","original_fcs":"head1000-6bc350ed079926dd38b1cb315ee5f7df16f847e7","original_path":"/typhoon/jason/prvbucket/_mountainprocess/output_firings_out_0bc58ac97c","original_size":1112948,"prv_version":"0.11"}},"filt_out":{"prv":{"original_checksum":"e1d80e3b637796e7775103754e5b95cdfa0dacf3","original_fcs":"head1000-5c955c1e9bf41c5733454b692346c07930b55542","original_path":"/typhoon/jason/prvbucket/_mountainprocess/output_timeseries_out_50027d1609","original_size":360000020,"prv_version":"0.11"}},"pre_out":{"prv":{"original_checksum":"f45c752c69c5075f54ab3666fe7074f2ff6e3b11","original_fcs":"head1000-45ab45da501eceb336323fc929ec1ea200b0ede8","original_path":"/typhoon/jason/prvbucket/_mountainprocess/output_timeseries_out_5bf26dde59","original_size":360000020,"prv_version":"0.11"}}},"parameters":{"samplerate":"30000","detect_sign":"","freq_min":300,"freq_max":6000,"freq_wid":1000,"whiten":"true","detect_threshold":3,"adjacency_radius":0},"status":"finished","error":"","process_id":"","pipeline_name":"sort"},{"job_type":"pipeline","input_file_names":{"pre":"pre","firings":"firings"},"output_file_names":{"curated_firings":"curated_firings"},"unresolved_parameters":{"samplerate":"30000"},"input_files":{"pre":{"prv":{"original_checksum":"f45c752c69c5075f54ab3666fe7074f2ff6e3b11","original_fcs":"head1000-45ab45da501eceb336323fc929ec1ea200b0ede8","original_path":"/typhoon/jason/prvbucket/_mountainprocess/output_timeseries_out_5bf26dde59","original_size":360000020,"prv_version":"0.11"}},"firings":{"prv":{"original_checksum":"945d592720f0fce3c6154b865cb72f8060ef5916","original_fcs":"head1000-6bc350ed079926dd38b1cb315ee5f7df16f847e7","original_path":"/typhoon/jason/prvbucket/_mountainprocess/output_firings_out_0bc58ac97c","original_size":1112948,"prv_version":"0.11"}}},"output_files":{"curated_firings":{"prv":{"original_checksum":"4802c5bd1d4f325500d9a704a78dd95ee35f1fd0","original_fcs":"head1000-b19bfa0e6ab0eee6b5c48ea632c591dc4491cb59","original_path":"/typhoon/jason/prvbucket/_mountainprocess/output_firings_out_1dbef61491","original_size":478556,"prv_version":"0.11"}}},"parameters":{"samplerate":"30000"},"status":"finished","error":"","process_id":"","pipeline_name":"curate"}]}